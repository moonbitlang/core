#!/bin/bash

# Pre-commit hook to ensure code quality with MoonBit
# This hook runs `moon check` to validate the code before allowing commits

set -e

echo "üåô Running MoonBit pre-commit checks..."

# Check if moon is available
if ! command -v moon &> /dev/null; then
    echo "‚ùå Error: 'moon' command not found. Please install MoonBit toolchain."
    echo "   Visit: https://www.moonbitlang.com/download/"
    exit 1
fi

# Run moon check
echo "üìã Running 'moon check'..."
if ! moon check; then
    echo ""
    echo "‚ùå Pre-commit hook failed!"
    echo "   'moon check' found issues in your code."
    echo "   Please fix the issues and try committing again."
    echo ""
    echo "üí° Common fixes:"
    echo "   - Run 'moon fmt' to auto-format your code"
    echo "   - Check for type errors and fix them"
    echo "   - Ensure all imports are valid"
    exit 1
fi

echo "‚úÖ All checks passed! Proceeding with commit..."
echo ""
