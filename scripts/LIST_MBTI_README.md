# List MoonBit Generated Interface Files

Scripts to list and review all `pkg.generated.mbti` files in the MoonBit Core project.

## Available Scripts

### Node.js Version (`list-mbti-files.mjs`)

**Usage:**
```bash
node scripts/list-mbti-files.mjs [options]
```

**Options:**
- `--relative` - Show paths relative to project root (default)
- `--absolute` - Show absolute paths
- `--count` - Only show the count of files
- `--json` - Output as JSON array
- `--review` - Review files using Codex SDK (with concurrency control)
- `--concurrency=N` - Number of concurrent reviews when using --review (default: 5)

**Examples:**
```bash
# List all files (relative paths)
node scripts/list-mbti-files.mjs

# Count total files
node scripts/list-mbti-files.mjs --count

# Get JSON output
node scripts/list-mbti-files.mjs --json

# Review all files with concurrency limit of 5 (default)
node scripts/list-mbti-files.mjs --review

# Review with custom concurrency limit
node scripts/list-mbti-files.mjs --review --concurrency=3
```

### Dedicated Review Script (`review-mbti-files.mjs`)

A standalone script specifically for reviewing mbti files with more options.

**Usage:**
```bash
node scripts/review-mbti-files.mjs [options]
```

**Options:**
- `--all` - Review all mbti files (default)
- `--changed` - Only review changed files in git
- `--files=path1,path2` - Specific files to review (comma-separated)
- `--concurrency=N` - Number of concurrent reviews (default: 5)
- `--verbose` - Show detailed progress

**Examples:**
```bash
# Review all files with default concurrency (5)
node scripts/review-mbti-files.mjs

# Review only changed files
node scripts/review-mbti-files.mjs --changed

# Review specific files
node scripts/review-mbti-files.mjs --files=bytes/pkg.generated.mbti,string/pkg.generated.mbti

# Review with custom concurrency limit
node scripts/review-mbti-files.mjs --concurrency=3 --verbose
```

### Bash Version (`list-mbti-files.sh`)

**Usage:**
```bash
./scripts/list-mbti-files.sh [options]
```

**Options:**
- `--count` - Only show the count of files
- `--absolute` - Show absolute paths (default is relative)
- `--help` - Show help message

**Examples:**
```bash
# List all files (relative paths)
./scripts/list-mbti-files.sh

# Count total files
./scripts/list-mbti-files.sh --count

# Show absolute paths
./scripts/list-mbti-files.sh --absolute
```

## What are `pkg.generated.mbti` files?

These files are automatically generated by the MoonBit build system (`moon info`) and contain the public interface definitions for each package. They specify:
- Exported functions and their signatures
- Public types and their methods
- Type aliases
- Trait implementations

These files should be committed to version control as they document the public API of each package.

## Common Use Cases

**Review recently changed interfaces:**
```bash
node scripts/review-mbti-files.mjs --changed
```

**Review specific package:**
```bash
node scripts/review-mbti-files.mjs --files=bytes/pkg.generated.mbti
```

**Control API rate limiting:**
```bash
# Lower concurrency to avoid rate limits
node scripts/review-mbti-files.mjs --concurrency=2

# Higher concurrency for faster reviews (if quota allows)
node scripts/review-mbti-files.mjs --concurrency=10
```

**Check if interfaces are up to date:**
```bash
moon info
git diff --name-only | grep pkg.generated.mbti
```

**Find packages that changed their public API:**
```bash
git diff main --name-only | grep pkg.generated.mbti
```

**List all packages in the project:**
```bash
node scripts/list-mbti-files.mjs | sed 's|/pkg.generated.mbti||'
```

**Count packages:**
```bash
node scripts/list-mbti-files.mjs --count
```

## Concurrency Control

The review scripts implement a concurrency limit to avoid overwhelming the OpenAI API service. The default concurrency is **5**, which means:

- Maximum 5 files are reviewed simultaneously
- New reviews start as soon as one completes
- Prevents API rate limiting and quota exhaustion
- Balances speed with resource usage

**Adjusting concurrency:**
- Lower (1-3): More conservative, better for rate limits
- Default (5): Balanced performance
- Higher (8-10): Faster but may hit rate limits

**Example timing (approximate):**
- 60 files @ concurrency=1: ~10 minutes
- 60 files @ concurrency=5: ~2-3 minutes  
- 60 files @ concurrency=10: ~1-2 minutes (if quota allows)
